[gcode_macro _CHECKS_MENU]
gcode:
    RESPOND TYPE=command MSG="action:prompt_end"
    RESPOND TYPE=command MSG="action:prompt_begin Toolhead Checks"
    RESPOND TYPE=command MSG="action:prompt_text Select test:"
    RESPOND TYPE=command MSG="action:prompt_button_group_start"
    RESPOND TYPE=command MSG="action:prompt_button Fans|_FAN_TEST|info"
    RESPOND TYPE=command MSG="action:prompt_button Probe|_PROBE_TEST|info"
    RESPOND TYPE=command MSG="action:prompt_button Wiggle|_WIGGLE_TEST|info"
    RESPOND TYPE=command MSG="action:prompt_button_group_end"
    RESPOND TYPE=command MSG="action:prompt_button_group_start"
    RESPOND TYPE=command MSG="action:prompt_button Heater|_HEATER_TEST|warning"
    RESPOND TYPE=command MSG="action:prompt_button Heatbreak|_HEATBREAK_TEST|warning"
    RESPOND TYPE=command MSG="action:prompt_button Back|_SERVICE_MENU|error"
    RESPOND TYPE=command MSG="action:prompt_button_group_end"
    RESPOND TYPE=command MSG="action:prompt_show"

[gcode_macro _RETURN_CHECKS]
gcode:
    _CHECKS_MENU

[gcode_macro _FAN_TEST]
gcode:
    M118 Fan test start...
    M106 S0
    G4 P1000
    M106 S80
    G4 P2000
    M106 S160
    G4 P3000
    M106 S255
    G4 P3000
    M106 S160
    G4 P2000
    M106 S80
    G4 P1000
    M106 S0
    M118 Fan test complete.
    RESPOND TYPE=command MSG="action:prompt_begin Fan Test"
    RESPOND TYPE=command MSG="action:prompt_text Fan test done."
    RESPOND TYPE=command MSG="action:prompt_button OK|_RETURN_CHECKS|info"
    RESPOND TYPE=command MSG="action:prompt_show"

[gcode_macro _WIGGLE_TEST]
gcode:
    {% set xc = (printer.toolhead.axis_minimum.x + printer.toolhead.axis_maximum.x)/2 %}
    {% set yc = (printer.toolhead.axis_minimum.y + printer.toolhead.axis_maximum.y)/2 %}
    M118 Wiggle test start...
    G90
    G0 X{xc} Y{yc}
    {% for i in range(10) %}
        G0 X{xc+5}
        G0 X{xc-5}
    {% endfor %}
    {% for i in range(10) %}
        G0 Y{yc+5}
        G0 Y{yc-5}
    {% endfor %}
    M118 Wiggle test done.
    RESPOND TYPE=command MSG="action:prompt_begin Wiggle Test"
    RESPOND TYPE=command MSG="action:prompt_text Wiggle test complete."
    RESPOND TYPE=command MSG="action:prompt_button OK|_RETURN_CHECKS|info"
    RESPOND TYPE=command MSG="action:prompt_show"

[gcode_macro _HEATER_TEST]
gcode:
    M118 Heater test start...
    M104 S200
    TEMPERATURE_WAIT SENSOR=extruder MINIMUM=195
    G4 P15000
    M104 S0
    M118 Heater test done.
    RESPOND TYPE=command MSG="action:prompt_begin Heater Test"
    RESPOND TYPE=command MSG="action:prompt_text Heater test complete."
    RESPOND TYPE=command MSG="action:prompt_button OK|_RETURN_CHECKS|info"
    RESPOND TYPE=command MSG="action:prompt_show"

[gcode_macro _HEATBREAK_TEST]
gcode:
    M118 Heatbreak test start...
    M104 S150
    TEMPERATURE_WAIT SENSOR=extruder MINIMUM=145
    M106 S0
    G4 P5000
    M106 S255
    G4 P10000
    M104 S0
    M106 S0
    M118 Heatbreak test done.
    RESPOND TYPE=command MSG="action:prompt_begin Heatbreak Test"
    RESPOND TYPE=command MSG="action:prompt_text Heatbreak test complete."
    RESPOND TYPE=command.MSG="action:prompt_button OK|_RETURN_CHECKS|info"
    RESPOND TYPE=command MSG="action:prompt_show"
